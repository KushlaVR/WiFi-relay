/*!
 * ClockPicker v0.0.7 (http://weareoutman.github.io/clockpicker/)
 * Copyright 2014 Wang Shenwei.
 * Licensed under MIT (https://github.com/weareoutman/clockpicker/blob/master/LICENSE)
 */
(function(){function e(n){return document.createElementNS(b,n)}function o(n){return(n<10?"0":"")+n}function tt(n){var t=++nt+"";return n?n+t:t}function t(t,a){function at(n,t){var b=ot.offset(),k=/^touch/.test(n.type),h=b.left+i,c=b.top+i,e=(k?n.originalEvent.touches[0]:n).pageX-h,o=(k?n.originalEvent.touches[0]:n).pageY-c,d=Math.sqrt(e*e+o*o),w=!1,nt;if(!t||!(d<r-u||d>r+u)){n.preventDefault();nt=setTimeout(function(){l.addClass("clockpicker-moving")},200);s&&ot.append(g.canvas);g.setHand(e,o,!t,!0);f.off(v).on(v,function(n){n.preventDefault();var t=/^touch/.test(n.type),i=(t?n.originalEvent.touches[0]:n).pageX-h,r=(t?n.originalEvent.touches[0]:n).pageY-c;(w||i!==e||r!==o)&&(w=!0,g.setHand(i,r,!1,!0))});f.off(y).on(y,function(n){f.off(y);n.preventDefault();var i=/^touch/.test(n.type),r=(i?n.originalEvent.changedTouches[0]:n).pageX-h,u=(i?n.originalEvent.changedTouches[0]:n).pageY-c;(t||w)&&r===e&&u===o&&g.setHand(r,u);g.currentView==="hours"?g.toggleView("minutes",p/2):a.autoclose&&(g.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){g.done()},p/2));ot.prepend(vt);clearTimeout(nt);l.removeClass("clockpicker-moving");f.off(v)})}}var k=n(it),ot=k.find(".clockpicker-plate"),yt=k.find(".clockpicker-hours"),wt=k.find(".clockpicker-minutes"),ni=k.find(".clockpicker-am-pm-block"),bt=t.prop("tagName")==="INPUT",kt=bt?t:t.find("input"),dt=t.find(".input-group-addon"),g=this,gt,ti,lt,w,b,nt,pt,ft,vt,et,rt,ut,st,ht,ct;this.id=tt("cp");this.element=t;this.options=a;this.isAppended=!1;this.isShown=!1;this.currentView="hours";this.isInput=bt;this.input=kt;this.addon=dt;this.popover=k;this.plate=ot;this.hoursView=yt;this.minutesView=wt;this.amPmBlock=ni;this.spanHours=k.find(".clockpicker-span-hours");this.spanMinutes=k.find(".clockpicker-span-minutes");this.spanAmPm=k.find(".clockpicker-span-am-pm");this.amOrPm="PM";a.twelvehour&&(gt='<div class="clockpicker-am-pm-block"><button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-am-button">AM<\/button><button type="button" class="btn btn-sm btn-default clockpicker-button clockpicker-pm-button">PM<\/button><\/div>',ti=n(gt),n('<button type="button" class="btn btn-sm btn-default clockpicker-button am-button">AM<\/button>').on("click",function(){g.amOrPm="AM";n(".clockpicker-span-am-pm").empty().append("AM")}).appendTo(this.amPmBlock),n('<button type="button" class="btn btn-sm btn-default clockpicker-button pm-button">PM<\/button>').on("click",function(){g.amOrPm="PM";n(".clockpicker-span-am-pm").empty().append("PM")}).appendTo(this.amPmBlock));a.autoclose||n('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+a.donetext+"<\/button>").click(n.proxy(this.done,this)).appendTo(k);(a.placement==="top"||a.placement==="bottom")&&(a.align==="top"||a.align==="bottom")&&(a.align="left");(a.placement==="left"||a.placement==="right")&&(a.align==="left"||a.align==="right")&&(a.align="top");k.addClass(a.placement);k.addClass("clockpicker-align-"+a.align);this.spanHours.click(n.proxy(this.toggleView,this,"hours"));this.spanMinutes.click(n.proxy(this.toggleView,this,"minutes"));kt.on("focus.clockpicker click.clockpicker",n.proxy(this.show,this));dt.on("click.clockpicker",n.proxy(this.toggle,this));if(lt=n('<div class="clockpicker-tick"><\/div>'),a.twelvehour)for(w=1;w<13;w+=1){b=lt.clone();nt=w/6*Math.PI;ft=r;b.css("font-size","120%");b.css({left:i+Math.sin(nt)*ft-u,top:i-Math.cos(nt)*ft-u});b.html(w===0?"00":w);yt.append(b);b.on(h,at)}else for(w=0;w<24;w+=1){b=lt.clone();nt=w/6*Math.PI;pt=w>0&&w<13;ft=pt?c:r;b.css({left:i+Math.sin(nt)*ft-u,top:i-Math.cos(nt)*ft-u});pt&&b.css("font-size","120%");b.html(w===0?"00":w);yt.append(b);b.on(h,at)}for(w=0;w<60;w+=5){b=lt.clone();nt=w/30*Math.PI;b.css({left:i+Math.sin(nt)*r-u,top:i-Math.cos(nt)*r-u});b.css("font-size","120%");b.html(o(w));wt.append(b);b.on(h,at)}ot.on(h,function(t){n(t.target).closest(".clockpicker-tick").length===0&&at(t,!0)});s&&(vt=k.find(".clockpicker-canvas"),et=e("svg"),et.setAttribute("class","clockpicker-svg"),et.setAttribute("width",d),et.setAttribute("height",d),rt=e("g"),rt.setAttribute("transform","translate("+i+","+i+")"),ut=e("circle"),ut.setAttribute("class","clockpicker-canvas-bearing"),ut.setAttribute("cx",0),ut.setAttribute("cy",0),ut.setAttribute("r",2),st=e("line"),st.setAttribute("x1",0),st.setAttribute("y1",0),ht=e("circle"),ht.setAttribute("class","clockpicker-canvas-bg"),ht.setAttribute("r",u),ct=e("circle"),ct.setAttribute("class","clockpicker-canvas-fg"),ct.setAttribute("r",3.5),rt.appendChild(st),rt.appendChild(ht),rt.appendChild(ct),rt.appendChild(ut),et.appendChild(rt),vt.append(et),this.hand=st,this.bg=ht,this.fg=ct,this.bearing=ut,this.g=rt,this.canvas=vt)}var n=window.jQuery,w=n(window),f=n(document),l,b="http://www.w3.org/2000/svg",s="SVGAngle"in window&&function(){var t,n=document.createElement("div");return n.innerHTML="<svg/>",t=(n.firstChild&&n.firstChild.namespaceURI)==b,n.innerHTML="",t}(),g=function(){var n=document.createElement("div").style;return"transition"in n||"WebkitTransition"in n||"MozTransition"in n||"msTransition"in n||"OTransition"in n}(),a="ontouchstart"in window,h="mousedown"+(a?" touchstart":""),v="mousemove.clockpicker"+(a?" touchmove.clockpicker":""),y="mouseup.clockpicker"+(a?" touchend.clockpicker":""),k=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,nt=0,i=100,r=80,c=54,u=13,d=i*2,p=g?350:1,it='<div class="popover clockpicker-popover"><div class="arrow"><\/div><div class="popover-title"><span class="clockpicker-span-hours text-primary"><\/span> : <span class="clockpicker-span-minutes"><\/span><span class="clockpicker-span-am-pm"><\/span><\/div><div class="popover-content"><div class="clockpicker-plate"><div class="clockpicker-canvas"><\/div><div class="clockpicker-dial clockpicker-hours"><\/div><div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"><\/div><\/div><span class="clockpicker-am-pm-block"><\/span><\/div><\/div>';t.DEFAULTS={"default":"",fromnow:0,placement:"bottom",align:"left",donetext:"完成",autoclose:!1,twelvehour:!1,vibrate:!0};t.prototype.toggle=function(){this[this.isShown?"hide":"show"]()};t.prototype.locate=function(){var r=this.element,i=this.popover,t=r.offset(),u=r.outerWidth(),f=r.outerHeight(),e=this.options.placement,o=this.options.align,n={},s=this;i.show();switch(e){case"bottom":n.top=t.top+f;break;case"right":n.left=t.left+u;break;case"top":n.top=t.top-i.outerHeight();break;case"left":n.left=t.left-i.outerWidth()}switch(o){case"left":n.left=t.left;break;case"right":n.left=t.left+u-i.outerWidth();break;case"top":n.top=t.top;break;case"bottom":n.top=t.top+f-i.outerHeight()}i.css(n)};t.prototype.show=function(){var t,i,r;if(!this.isShown){if(t=this,!this.isAppended){l=n(document.body).append(this.popover);w.on("resize.clockpicker"+this.id,function(){t.isShown&&t.locate()});this.isAppended=!0}i=((this.input.prop("value")||this.options["default"]||"")+"").split(":");i[0]==="now"&&(r=new Date(+new Date+this.options.fromnow),i=[r.getHours(),r.getMinutes()]);this.hours=+i[0]||0;this.minutes=+i[1]||0;this.spanHours.html(o(this.hours));this.spanMinutes.html(o(this.minutes));this.toggleView("hours");this.locate();this.isShown=!0;f.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(i){var r=n(i.target);r.closest(t.popover).length===0&&r.closest(t.addon).length===0&&r.closest(t.input).length===0&&t.hide()});f.on("keyup.clockpicker."+this.id,function(n){n.keyCode===27&&t.hide()})}};t.prototype.hide=function(){this.isShown=!1;f.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id);f.off("keyup.clockpicker."+this.id);this.popover.hide()};t.prototype.toggleView=function(n,t){var i=n==="hours",u=i?this.hoursView:this.minutesView,r=i?this.minutesView:this.hoursView;this.currentView=n;this.spanHours.toggleClass("text-primary",i);this.spanMinutes.toggleClass("text-primary",!i);r.addClass("clockpicker-dial-out");u.css("visibility","visible").removeClass("clockpicker-dial-out");this.resetClock(t);clearTimeout(this.toggleViewTimer);this.toggleViewTimer=setTimeout(function(){r.css("visibility","hidden")},p)};t.prototype.resetClock=function(n){var u=this.currentView,t=this[u],f=u==="hours",a=Math.PI/(f?6:30),e=t*a,o=f&&t>0&&t<13?c:r,h=Math.sin(e)*o,l=-Math.cos(e)*o,i=this;s&&n?(i.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){i.canvas.removeClass("clockpicker-canvas-out");i.setHand(h,l)},n)):this.setHand(h,l)};t.prototype.setHand=function(t,i,u,f){var h=Math.atan2(t,-i),l=this.currentView==="hours",p=Math.PI/(l||u?6:30),d=Math.sqrt(t*t+i*i),w=this.options,b=l&&d<(r+c)/2,y=b?c:r,e,a,v;if(w.twelvehour&&(y=r),h<0&&(h=Math.PI*2+h),e=Math.round(h/p),h=e*p,w.twelvehour?l?e===0&&(e=12):(u&&(e*=5),e===60&&(e=0)):l?(e===12&&(e=0),e=b?e===0?12:e:e===0?0:e+12):(u&&(e*=5),e===60&&(e=0)),this[this.currentView]!==e&&k&&this.options.vibrate&&(this.vibrateTimer||(navigator[k](10),this.vibrateTimer=setTimeout(n.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=e,this[l?"spanHours":"spanMinutes"].html(o(e)),!s){this[l?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var t=n(this);t.toggleClass("active",e===+t.html())});return}f||!l&&e%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));a=Math.sin(h)*y;v=-Math.cos(h)*y;this.hand.setAttribute("x2",a);this.hand.setAttribute("y2",v);this.bg.setAttribute("cx",a);this.bg.setAttribute("cy",v);this.fg.setAttribute("cx",a);this.fg.setAttribute("cy",v)};t.prototype.done=function(){this.hide();var t=this.input.prop("value"),n=o(this.hours)+":"+o(this.minutes);this.options.twelvehour&&(n=n+this.amOrPm);this.input.prop("value",n);n!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change"));this.options.autoclose&&this.input.trigger("blur")};t.prototype.remove=function(){this.element.removeData("clockpicker");this.input.off("focus.clockpicker click.clockpicker");this.addon.off("click.clockpicker");this.isShown&&this.hide();this.isAppended&&(w.off("resize.clockpicker"+this.id),this.popover.remove())};n.fn.clockpicker=function(i){var r=Array.prototype.slice.call(arguments,1);return this.each(function(){var u=n(this),f=u.data("clockpicker"),e;f?typeof f[i]=="function"&&f[i].apply(f,r):(e=n.extend({},t.DEFAULTS,u.data(),typeof i=="object"&&i),u.data("clockpicker",new t(u,e)))})}})();