var __extends=this&&this.__extends||function(){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),WebUI=function(){function n(){}return n.prototype.init=function(){var n=Model.getUrlParameter("setup");this.model=n===undefined?new HomePage:new SetupPage;this.model.init()},n.rooturl="api/",n}(),Model=function(){function n(){this.templates=[];this.elements=[]}return n.getUrlParameter=function(n){for(var u=window.location.search.substring(1),r=u.split("&"),t,i=0;i<r.length;i++)if(t=r[i].split("="),t[0]===n)return t[1]===undefined?!0:decodeURIComponent(t[1]);return undefined},n.prototype.init=function(){var n=$("#questionModal");n.length>0&&(WebUI.questionTemplate=$("#questionModal")[0].innerHTML)},n.prototype.fillTemplate=function(n,t){var i=n,r,f,u;for(r in t)for(f=t[r],u="@"+r+"@";i.indexOf(u)>=0;)i=i.replace(u,f);return i},n.prototype.loadFailed=function(n,t){this.updateTime(n);$(".process-list").html("Не вдалось завантажити. <button class'btn btn-primary refresh'>Повторити<\/button>");$(".refresh").click(function(){t&&t()})},n.prototype.updateTime=function(n){n.systime&&$("#systime").html(n.systime)},n.prototype.loadTemplateByName=function(n,t){var i=this;$.get(WebUI.rooturl+"template?name="+n).done(function(n){return i.templateByNameLoaded(n,t)}).fail(function(n){return i.loadFailed(n,i.loadElementsTemplate)})},n.prototype.templateByNameLoaded=function(n,t){this.updateTime(n);var i=new keyValue;i.key=name;i.value=n;this.templates.push(i);t()},n.prototype.getTemplate=function(n){for(var i,t=0;t<this.templates.length;t++)if(i=this.templates[t],i.key===n)return i.value;return undefined},n.prototype.allElementsTemplateLoaded=function(n){for(var r=0;r<this.elements.length;r++){var u=this.elements[r],t=u.template,i=void 0;if(!(t===undefined)&&(i=this.getTemplate(t),i===undefined)||(t=u.editingtemplate,!(t===undefined)&&(i=this.getTemplate(t),i===undefined))||(t=u.visual,!(t===undefined)&&(i=this.getTemplate(t),i===undefined)))return this.loadTemplateByName(t,n),!1}return!0},n.prototype.loadElementsTemplate=function(){var u=this,f=this.allElementsTemplateLoaded(function(){return u.loadElementsTemplate()}),n,i,t,r;if(f!==!1){for(n="",i=0;i<this.elements.length;i++)t=this.elements[i],t.visual&&(r=this.getTemplate(t.visual),r===undefined?(n+="<li class='nav-item'>",n+=t.name,n+="<\/li>"):n+=this.fillTemplate(r,t));$(".process-list").html(n);this.allLoaded();Converters.ConvertAll()}},n.prototype.allLoaded=function(){},n}(),HomePage=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.init=function(){n.prototype.init.call(this);this.loadProcesses()},t.prototype.loadProcesses=function(){var n=this;$.get(WebUI.rooturl+"switches").done(function(t,i){return n.ProcessesLoaded(t,i)}).fail(function(t){return n.loadFailed(t,n.loadProcesses)})},t.prototype.ProcessesLoaded=function(n){var i,r,t;for(this.updateTime(n),i=n,r="",t=0;t<i.items.length;t++)this.elements.push(i.items[t]);this.loadElementsTemplate()},t.prototype.allLoaded=function(){n.prototype.allLoaded.call(this);$(".switch-checkbox[data-state='ON']").prop("checked",!0);$("img[data-state='ON']").removeClass("light-off");$(".switch-img").click(function(){var n=$(".switch-checkbox",$(this).closest(".card"));n.data("state")=="ON"?this.turnOff(n.data("switch")):this.turnOn(n.data("switch"))});$(".switch-checkbox").change(function(){this.checked?this.turnOn($(this).data("switch")):this.turnOff($(this).data("switch"))})},t.prototype.turnOn=function(n){if($("#switch_"+n.toString()).data("state")!="ON")return console.log("turn on"),$.post(WebUI.rooturl+"switches?index="+n.toString()+"&state=on").done(function(t){t.systime&&$("#systime").html(t.systime);$("#switch_"+n.toString()).data("state","ON");$("#switch_img_"+n.toString()).removeClass("light-off").addClass("light-on");$("#switch_"+n.toString()).prop("checked",!0)}).fail(function(){$("#switch_"+n.toString()).prop("checked",!1)}),!0},t.prototype.turnOff=function(n){if($("#switch_"+n.toString()).data("state")!="OFF")return console.log("turn off"),$.post(WebUI.rooturl+"switches?index="+n.toString()+"&state=off").done(function(t){t.systime&&$("#systime").html(t.systime);$("#switch_"+n.toString()).data("state","OFF");$("#switch_img_"+n.toString()).removeClass("light-on").addClass("light-off");$("#switch_"+n.toString()).prop("checked",!1)}).fail(function(){$("#switch_"+n.toString()).prop("checked",!0)}),!0},t}(Model),SetupPage=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t.prototype.init=function(){n.prototype.init.call(this)},t}(Model),WIFI_list=function(){function n(){}return n}(),Items_list=function(){function n(){}return n}(),keyValue=function(){function n(){}return n}(),Trigger=function(){function n(){}return n}(),Converters=function(){function n(){}return n.ConvertAll=function(){TimeConverter.Convert();TextConverter.Convert();WeekDaysConverter.Convert()},n}(),TimeConverter=function(){function n(){}return n.Convert=function(){var t=$(".converter-time").each(function(t,i){var r=$(i),e,u,f;r.data("converted")!=="1"&&(e=i.tagName==="INPUT"?r.val():i.innerHTML,u="",f=parseInt(e,10),u=n.pad(Math.floor(f/60).toString(),2)+":"+n.pad((f%60).toString(),2),r.data("converted","1"),i.tagName==="INPUT"?r.attr("value",u):i.innerHTML=u)})},n.ConvertBack=function(n){var t=$(n),i,r,u;return t.data("converted")==="1"?(i=void 0,i=n.tagName==="INPUT"?t.val():n.innerHTML,r=i.split(":"),u=parseInt(r[0])*60+parseInt(r[1]),u.toString()):t.val()},n.pad=function(n,t){for(var i=n;i.length<(t||2);)i="0"+i;return i},n}(),TextConverter=function(){function n(){}return n.Convert=function(){},n.ConvertBack=function(n){var t=$(n);return t.attr("type")==="checkbox"?t.prop("checked"):t.val()},n}(),WeekDaysConverter=function(){function n(){}return n.Convert=function(){var t=$(".converter-week-days").each(function(t,i){var f=$(i),e,r,o,u;if(f.data("converted")!=="1"){for(e=i.tagName==="INPUT"?f.val():i.innerHTML,r="",o=parseInt(e,10),u=0;u<7;u++)(o&1<<u)!=0&&(r.length>0&&(r+=", "),r+=n.weekday[u]);f.data("converted","1");i.tagName==="INPUT"?f.attr("value",r):i.innerHTML=r}})},n.ConvertBack=function(t){var r=$(t),u,f,e,i,o;if(r.data("converted")==="1"){for(u=void 0,u=t.tagName==="INPUT"?r.val():t.innerHTML,f=u.split(","),e=0,i=0;i<f.length;i++)o=n.weekday.indexOf(f[i].trim()),o>=0&&(e+=1<<o);return e.toString()}return r.val()},n.weekday=["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],n}();